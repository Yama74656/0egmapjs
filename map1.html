<!DOCTYPE html><html lang="ja"><head><meta charset="utf-8"/>

<title>MAP</title>

<link rel="apple-touch-icon" href="app-icon.png"/>
<meta property="og:image" content="ogp-image.jpg"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js"></script>
<script src="https://code4fukui.github.io/egmapjs/egmap.js"></script>
<link rel="stylesheet" href="https://code4fukui.github.io/egmapjs/egmap.css"/>
<script src="https://fukuno.jig.jp/fukuno.js"></script>
<script src="https://code4fukui.github.io/egmapjs/sparql.js"></script>
<script>"use strict"

window.onload = function() {
	var map = initMap('mapid')
	map.setZoom(16)
	map.panTo([ 36.06165,136.223546 ]) // 福井駅
	
	map.addIcon(36.06165, 136.223546,"福井駅")
	
// SPARQLクエリー
	var query = `
		prefix ic: <http://imi.go.jp/ns/core/rdf#>
		prefix xsd: <http://www.w3.org/2001/XMLSchema#>
		prefix xsd <http://www.w3.org/2003/01/geo/wgs84_pos#lat>

	:
		select ?uri ?name ?lat ?lng {
			?uri ic:名称 [ ic:表記 ?name ].
			?uri ic:地理座標 [ ic:緯度 ?lat; ic:経度 ?lng;]
		} limit 100
	`
	querySPARQL(query, function(data) {
		var items = data.results.bindings;
		for (var i = 0; i < items.length; i++) {
			var item = items[i];
			var lat = item.lat.value;
			var lng = item.lng.value;
			var name = item.name.value;
			map.addIcon(lat, lng, name,"icon-carparking.png",50,50)
		}
	});
	var current = map.addIcon(0, 0, "現在地", "icon-walking.png", 64, 64)
	navigator.geolocation.watchPosition(function(gpos) {
		const pos = [ gpos.coords.latitude, gpos.coords.longitude ]
		current.setLatLng(pos)
		
	}, function() {
		alert("現在位置に取得に失敗！")
	})
	
	map.on("click", (e) => alert(e.latlng))
	
	// 線分を地図上に表示する
	map.addLayer(L.polyline([
		    [ 36.062523, 136.222834 ],//ずれ調整
	    	[36.062498,136.219042],
	    	[36.062687,136.216385],
	    	[36.063251,136.21402],
	    	[36.06411,136.212005],
	    	[36.061646,136.210476],//久保町
            	[36.061672,136.207657],
	    	[36.061657,136.203903],
	   	[36.061638,136.20076],
	    	[36.061703,136.198517],
			[36.061743,136.195815],//ずれ調整
	    	[36.062,136.194901],
	    	[36.06319,136.192337],
			[36.063703,136.19066],
			[36.063563,136.190193],
	    	[36.06295,136.189545],//渡団地入口
	    	[36.061443,136.18811],
		[36.060295,136.186401],
		[36.059673,136.183578],
		[36.057182,136.178726],
		[36.05584,136.177994],
		[36.053448,136.178726],
		[36.051472,136.179337],
			
		[36.050343,136.179672],//運動公園南口
			[36.049576,136.18003],//ずれ調整
		[36.049309,136.182236],
		[36.049076,136.18454],
		[36.048759,136.18631],
			[36.04872,136.186759],//ずれ調整
		[36.04583,136.187119],//福井市農協前
		[36.043167,136.18757],
			[36.037217,136.188174],//ずれ調整
		[36.035797,136.199493],
		[36.035172,136.202942],
		[36.034897,136.205414],
		[36.034771,136.212433],
			[36.034712,136.213494],//ずれ調整
		[36.035992,136.213531],
		[36.041096,136.21431],
		[36.043869,136.215118],
		[36.04612,136.215149],
		[36.048622,136.215088],
		[36.050987,136.215012],
		[36.053772,136.214798],
		[36.055691,136.214676],
		[36.058247,136.215042],
			[36.060646,136.216461],
		[36.062406,136.21893],

	], { color: 'red'}))
}
</script>
<style>

body { margin: 0; font-family: sans-serif; text-align: center; }
h1 { font-size: 5vw; margin: 0; }
#mapid { height: 60vh; }

</style></head><body>

<h1>MAP</h1>
<div id="mapid"></div>

</body></html>
